#!/bin/bash
BASEDIR=/home/pgsql
DBNAME=dbtrack
DATADIR=${BASEDIR}/${DBNAME}
PGPATH=/usr/lib/postgresql/8.2/bin
export DATADIR PGPATH DBNAME

sudo adduser postgres
sudo mkdir -p ${BASEDIR}
sudo chown postgres ${BASEDIR}
sudo chmod 750 ${BASEDIR}

su postgres -c "${PGPATH}/initdb -D ${DATADIR}"
su postgres -c "${PGPATH}/postmaster -D ${DATADIR} >${DATADIR}/logfile 2>&1 &"
su postgres -c "${PGPATH}/createdb -E UTF8 -D ${DATADIR} ${DBNAME} \"База данных TRACK\""


#ВНИМАНИЕ: используется аутентификация "trust" для локальных подсоединений.
#Вы можете её поменять, отредактировав pg_hba.conf или используя опцию -A,
#при следующем выполнении initdb.
#Success. You can now start the database server using:
#
#    /usr/lib/postgresql/8.2/bin/postgres -D /home/pgsql/dbtech
#or
#    /usr/lib/postgresql/8.2/bin/pg_ctl -D /home/pgsql/dbtech -l logfile start


sudo mkdir -p ${DATADIR}/dbs
sudo chown postgres ${DATADIR}/dbs 
sudo chmod 750 ${DATADIR}/dbs 
sudo mkdir -p ${DATADIR}/ind
sudo chown postgres ${DATADIR}/ind 
sudo chmod 750 ${DATADIR}/ind 
#dropdb ${DBNAME}
